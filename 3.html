<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DAMI X-PRO | ULTRA PLAYER</title>
    
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-body: #050505;
            --bg-card: #121212;
            --accent: #d4af37;
            --text-primary: #ffffff;
            --border: rgba(255, 255, 255, 0.1);
        }
        body { background-color: var(--bg-body); color: var(--text-primary); font-family: sans-serif; margin: 0; }
        .vjs-theme-city { width: 100%; aspect-ratio: 16/9; }
        .nav-container { display: flex; background: var(--bg-card); margin: 10px; border-radius: 12px; padding: 5px; }
        .tab-btn { flex: 1; padding: 10px; border-radius: 8px; font-weight: bold; color: #a1a1aa; cursor: pointer; border: none; background: transparent; }
        .tab-btn.active { background: var(--accent); color: #000; }
        .content-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; padding: 15px; }
        .card { background: var(--bg-card); border-radius: 10px; padding: 8px; text-align: center; border: 1px solid var(--border); transition: 0.3s; cursor: pointer; }
        .card:hover { border-color: var(--accent); transform: scale(1.02); }
        .card-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 6px; margin-bottom: 5px; background: #222; }
        .card-title { font-size: 11px; font-weight: bold; height: 2.4em; overflow: hidden; }
        .search-box { margin: 0 15px 10px; }
        .search-box input { width: 100%; background: var(--bg-card); border: 1px solid var(--border); padding: 12px; border-radius: 25px; color: #fff; outline: none; }
        .cat-scroll { display: flex; overflow-x: auto; gap: 8px; padding: 0 15px 10px; scrollbar-width: none; }
        .cat-btn { white-space: nowrap; padding: 6px 15px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; font-size: 12px; cursor: pointer; }
        .cat-btn.active { border-color: var(--accent); color: var(--accent); }
        #msg { background: #e11d48; color: white; padding: 8px; font-size: 11px; text-align: center; display: none; }
    </style>
</head>
<body>

    <div id="msg">ملاحظة: إذا لم يعمل البث، اضغط على أيقونة القفل بجانب الرابط وفعل "Insecure Content"</div>

    <div class="video-holder">
        <video id="my-video" class="video-js vjs-big-play-centered vjs-theme-city" controls preload="auto" width="100%" data-setup="{}">
            <p class="vjs-no-js">To view this video please enable JavaScript</p>
        </video>
    </div>

    <nav class="nav-container">
        <button onclick="switchMode('get_live_streams', 'get_live_categories', this)" class="tab-btn active">مباشر</button>
        <button onclick="switchMode('get_vod_streams', 'get_vod_categories', this)" class="tab-btn">أفلام</button>
        <button onclick="switchMode('get_series', 'get_series_categories', this)" class="tab-btn">مسلسلات</button>
    </nav>

    <div class="search-box">
        <input type="text" id="searchInput" placeholder="ابحث عن اسم القناة أو الفيلم...">
    </div>

    <div id="cats" class="cat-scroll"></div>

    <main id="grid" class="content-grid"></main>

    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script>
        const API = {
            base: "http://ottpro.iptvpro2.com:8789",
            user: "Oujakr12",
            pass: "87593226",
            proxy: "https://api.allorigins.win/get?url="
        };

        let state = { full: [], action: 'get_live_streams' };
        const vPlayer = videojs('my-video');

        async function getData(act, extra = "") {
            const url = `${API.base}/player_api.php?username=${API.user}&password=${API.pass}&action=${act}${extra}`;
            try {
                const res = await fetch(API.proxy + encodeURIComponent(url));
                const json = await res.json();
                return JSON.parse(json.contents);
            } catch (e) { return null; }
        }

        async function switchMode(act, catAct, btn) {
            state.action = act;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            const cats = await getData(catAct);
            if (cats) {
                document.getElementById('cats').innerHTML = `<button onclick="loadContent('all', this)" class="cat-btn active">الكل</button>` +
                    cats.map(c => `<button onclick="loadContent('${c.category_id}', this)" class="cat-btn">${c.category_name}</button>`).join('');
                loadContent('all');
            }
        }

        async function loadContent(id, btn) {
            if (btn) {
                document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }
            const data = await getData(state.action, id === 'all' ? '' : `&category_id=${id}`);
            if (data) {
                state.full = data;
                render(data.slice(0, 50));
            }
        }

        function render(list) {
            document.getElementById('grid').innerHTML = list.map(item => `
                <div class="card" onclick="play('${item.stream_id || item.series_id || item.vod_id}', '${item.container_extension || 'm3u8'}')">
                    <img src="${item.stream_icon || item.cover || 'https://via.placeholder.com/150'}" class="card-img" loading="lazy">
                    <div class="card-title">${item.name}</div>
                </div>
            `).join('');
        }

        function play(id, ext) {
            const type = state.action.includes('live') ? 'live' : (state.action.includes('vod') ? 'movie' : 'series');
            const format = state.action.includes('live') ? 'm3u8' : ext;
            const streamUrl = `${API.base}/${type}/${API.user}/${API.pass}/${id}.${format}`;
            
            document.getElementById('msg').style.display = 'block';

            vPlayer.src({
                src: streamUrl,
                type: (format === 'm3u8') ? 'application/x-mpegURL' : 'video/mp4'
            });

            vPlayer.play().catch(() => {
                console.log("تأكد من تفعيل Insecure Content في المتصفح");
            });

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        document.getElementById('searchInput').oninput = (e) => {
            const val = e.target.value.toLowerCase();
            const filtered = state.full.filter(i => i.name.toLowerCase().includes(val));
            render(filtered.slice(0, 50));
        };

        window.onload = () => switchMode('get_live_streams', 'get_live_categories', document.querySelector('.tab-btn'));
    </script>
</body>
</html>
